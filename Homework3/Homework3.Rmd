---
title: 'STAT332 Statistical Analysis of Networks Sec 01 - Homework 3 - Prof. Joe Reid'
author: "Andrew Sparkes"
date: "`r Sys.Date()`"
due: "30-01-2026"
output:
  html_document:
    self_contained: true
    df_print: paged
  pdf_document: default
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(echo = TRUE)

library(networkdata)
library(igraph)
library(ggraph)
library(visNetwork)
library(tidygraph)
```

```{r user_configurable_settings}
SKIP_AHEAD = TRUE # skips ahead and truncates off the demo code/markdown (uses a TeX comment to omit output)
```


```{r extra_functions}
print_igraph_attr <- function(graph) {
  print("--- Graph Attributes ------")
  print(graph_attr(graph))

  print("--- Vertex Attributes ------")
  print(vertex_attr(graph))

  print("--- Edge Attributes ------")
  print(edge_attr(graph))
}
```

This homework is focused on plotting with `ggraph` and `visNetwork` but will also be used to explore the `tidygraph` framework. `tidygraph` is a library which provides a subclass of igraph and enables much smoother manipulation of graph objects using the tidyverse methodologies.

## Instructions:

Please complete this homework assignment by the due data posted on canvas. Please submit your work in an html file with solutions and code presented completely.

`r if(SKIP_AHEAD) {"Commenting out middle chunks to skip to the relevant bits!\\n\\n... snip ...\\n\\begin{comment}"}`

First, make sure to install the `networkdata` package. This package isn't located in CRAN so it takes a little bit of work using remotes library to get. If you don't have remotes, install that first. Then, install network data using these instructions: <https://www.rdocumentation.org/packages/networkdata/versions/0.1.6>

# 1.) Getting the Data

```{r reference_code}
# install.packages("drat")
# drat::addRepo("schochastics")
# install.packages("networkdata")

# OR for dev version:
# install.packages("remotes")
# remotes::install_github("schochastics/networkdata")

# installing the dev version for now
```

```{r}
?wta
```

We are going to use the `wta` dataset for this. Specifically, we are going to use the data from **2007**. Extracting this data isn't difficult but it is a little weird. The `wta` dataset is a list of `igraph`s, so you would think all that's necessary to get the first item in the list is to use `wta[1]`. Try a summary of this:

```{r}
summary(wta[40]) # assuming this was supposed to be summary(wta[1])? for the a list with the first igraph object? instead of the 40th?
```

Interestingly, you didn't get the `igraph`! You got the list item but not what's in it. To get that, you actually need to use a double bracket: `wta[[1]]`.

```{r}
class(wta[[40]]) # extract with the double bracket, list with the single
```

So, this is a directed, named, weighted dataset with **255** players and **1,771** edges where the edge weights denote the number of times the "from" player lost to the "to" player on a specific surface type. Let's store this as `g`.

```{r}
g <- wta[[40]] # storing just the 40th igraph in the wta dataset list for year 2007
```

Now, getting a look at the actual values of the matrix of node attributes or edge attributes is actually not obvious; however, if we convert this using a `as_tbl_graph()` with `tidygraph`, we can make this much easier.

```{r}
library(tidygraph)
g2 <- as_tbl_graph(g)
```

Now, these objects are interesting because we can activate either the nodes or the edges (whatever we want to work with.) When we work with one set (for example, by applying filtering), the other set is also affected. We have to be careful though, because edge filtering won't necessarily remove all corresponding nodes, but removing a node will absolutely remove all edges attached to that node. We should note that there are **55** total countries represented here. This is going to be a bit much to draw, so we're going to limit our dataset.

```{r display_num_unique_countries}
length(unique(V(g2)$country))
```

In order to perform operations on this, we need to activate either nodes or edges and then apply our filter operations using `filter()`. This works exactly the same as it does in the `tidyverse` methodology and can be found easily online.

```{r}
g3 <- g2 |>
  activate("nodes") |>
  filter(country %in% c("USA", "GBR", "AUS")) |>
  filter(!node_is_isolated())
```

Saving your data at this point is a good idea. You can do this with `write_graph()` as follows.

```{r}
write_graph(g3, format = "gml", file = "Homework_3_filtered_data.gml")
```

Now, it's time to do our work:

`r if(SKIP_AHEAD) {"\\end{comment}"}`

# 2.) Graph with ggraph

![](igraph plot.png){width = 200%, height = 200%}

Your job is to produce the code/graph which reproduces or improves on this graph using the `ggraph` and `visNetwork` packages. Good luck!

---

First off, let's take a look at this graph and note the important features:
 - There are 4 legends at each of the 4 corners:
  - vertex color based on `country` in bottom right, shown as fill of squares for icons in red, yellow, blue for USA, AUS, GBR respectively
  - vertex size based on `age` (legend only showing min, max) in bottom left
  - vertex shape based on `hand` (legend showing U, R, L) in top right
  - edge color based on `surface` (legend showing Hard, Grass, Clay, Carpet)
 - We can see one isolated component to the right, with 4 nodes, and a main more-connected component to the center
 - edge thickness does seem to vary, but it does not have a legend associated with it (assuming based on strength/degree?)
 - title top center: "Tennis Losses from 2007", color black, bolded
 - subtitle top center (below title): "Data represents players from USA, GBR, and AUS", color black, normal font size
 - caption bottom center: "Data from networkdata R package", wta dataset, color gray, small
 - edge arrow style is ... kinda weird. The arrows are offset back down towards the source of the arrow. (maybe there is a arrow offset param to adjust?)
 
Now, using each of those bullet points as a code chunk beginning:

```{r}
library(ggraph)

# graph creation

# plot and layout settings

# edge settings
# - edge thickness does seem to vary, but it does not have a legend associated with it (assuming based on strength/degree?)
# - edge arrow style is ... kinda weird. The arrows are offset back down towards the source of the arrow. (maybe there is a arrow offset param to adjust?)
# - edge color based on `surface`

# vertex settings
# - vertex color based on `country`
# - vertex size based on `age`
# - vertex shape based on `hand`

# legends
# - There are 4 legends at each of the 4 corners:
#  - vertex color based on `country` in bottom right, shown as fill of squares for icons in red, yellow, blue for USA, AUS, GBR respectively
#  - vertex size based on `age` (legend only showing min, max) in bottom left
#  - vertex shape based on `hand` (legend showing U, R, L) in top right
#  - edge color based on `surface` (legend showing Hard, Grass, Clay, Carpet)

# titles and text
# - title top center: "Tennis Losses from 2007", color black, bolded
# - subtitle top center (below title): "Data represents players from USA, GBR, and AUS", color black, normal font size
# - caption bottom center: "Data from networkdata R package", wta dataset, color gray, small

# plot
# TODO make graph happen!


# - We can see one isolated component to the right, with 4 nodes, and a main more-connected component to the center
```

# 3.) Graph with visNetwork

```{r}
library(visNetwork)

# TODO make graph happen!
```
